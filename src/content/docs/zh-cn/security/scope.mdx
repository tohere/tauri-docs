---
title: 命令scope
sidebar:
  order: 3
---

scope 是定义 Tauri 命令允许(不允许)行为的细粒度方式.

scope分为 `allow` 和 `deny` 两类, 其中 `deny` 始终优先于 `allow` scope

scope类型必须是任何可被 [`serde`](https://docs.rs/serde/latest/serde/) 序列化的类型, 这些类型通常是特定于插件的, 对于在 Tauri 应用程序中实现的有scope的命令, scope类型需要再应用程序中被定义, 然后在命令实现中强制执行

例如, [`Fs`](https://github.com/tauri-apps/plugins-workspace/tree/plugins/fs) 插件允许你使用scope来允许或拒绝特定的目录和文件访问, [`http`](https://github.com/tauri-apps/plugins-workspace/tree/plugins/http) 插件运行你使用scope来过了被允许访问的 URL

scope被传递给命令, 命令本身负责处理或执行scope规则

:::caution

命令开发者需要确保不存在scope被绕过的可能, scope验证实现应该警告审核, 以确保正确性

:::

## 示例

这些示例来自于 [`Fs`](https://github.com/tauri-apps/plugins-workspace/tree/plugins/fs) 插件权限:

在这个插件中, 所有命令的scope类型是一个字符串, 其中包含一个鱼 [`glob`](https://docs.rs/glob/latest/glob/) 兼容的路径

```toml title="plugins/fs/permissions/autogenerated/base-directories/applocaldata.toml"
[[permission]]
identifier = "scope-applocaldata-recursive"
description = "这个scope可递归访问整个 `$APPLICATION` 文件夹, 包括子目录和文件"

[[permission.scope.allow]]
path = "$APPLOCALDATA/**"
```

```toml title="plugins/fs/permissions/deny-webview-data.toml"
[[permission]]
identifier = "deny-webview-data-linux"
description = '''
这将拒绝linux上的 `$APPLOCALDATA` 文件夹的读取权限,
因为webview的数据和配置存储在这里,
允许访问可能导致敏感信息泄露, 因此应该慎重考虑
'''
platforms = ["linux"]

[[scope.deny]]
path = "$APPLOCALDATA/**"

[[permission]]
identifier = "deny-webview-data-windows"
description = '''
这将禁止 windows 上 `$APPLOCALDATA/EBWebView` 文件夹的读取权限,
因为webview的数据和配置存储在这里
允许访问可能导致敏感信息泄露, 因此应该慎重考虑
'''
platforms = ["windows"]

[[scope.deny]]
path = "$APPLOCALDATA/EBWebView/**"
```

上述scope在 windows 上可以允许访问 `APPLOCALDATA` 文件夹, 同时阻止访问 `EBWebView` 子文件夹, 该文件包含敏感的webview数据

这些配置可以合并成一组, 从而减少重复配置, 并且对查看应用程序配置的人来说更容易理解

First the deny scopes are merged into `deny-default`:

首先将禁止范围合并为 `deny-default`

```toml title="plugins/fs/permissions/deny-default.toml"
[[set]]
identifier = "deny-default"
description = '''
这默认拒绝访问和Tauri相关的危险文件和文件夹
'''
permissions = ["deny-webview-data-linux", "deny-webview-data-windows"]
```

之后, deny 和 allow 权限会被合并

```toml
[[set]]
identifier = "scope-applocaldata-reasonable"
description = '''
这个scope允许访问 `APPLOCALDATA` 文件夹和子文件夹, 但不包括 linux,
同时在windows系统上默拒绝止访问危险的tauri相关的文件和文件夹
'''
permissions = ["scope-applocaldata-recursive", "deny-default"]
```

这些scope也可以被用于所有命令, 通过扩展插件的全局范围, 或者仅用于选定的命令, 当它们与权限内的已启用命令结合使用时

合理的对 `APPLOCALDATA` 文件夹中的文件的只读权限看起来像这样:

```toml
[[set]]
identifier = "read-files-applocaldata"
description = '''
这个设置允许对 `APPLOCALDATA` 文件夹和子文件夹里的文件进行读取, 但是 linux 系统除外,
同时它在windows上默认拒绝访问与Tauri相关的危险文件和文件夹
'''
permissions = ["scope-applocaldata-reasonable", "allow-read-file"]
```

这些例子仅突出 scope 功能本身, 每个插件或者应用开发者需要根据其使用情况考虑合理的 scope 组合
