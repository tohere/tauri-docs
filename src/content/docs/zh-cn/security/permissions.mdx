---
title: 权限(Permissions)
sidebar:
  order: 2
---

许可(Permissions)是对命令明确权限的描述

```toml
[[permission]]
identifier = "my-identifier"
description = "This describes the impact and more."
commands.allow = [
    "read_file"
]

[[scope.allow]]
my-scope = "$HOME/*"

[[scope.deny]]
my-scope = "$HOME/secret"
```

Permissions 可以让命令在 Tauri 应用程序的前端被访问. 它可以将作用域映射到命令, 并定义哪些命令是启用的.
Permissions 可以启动或者禁用特定的命令, 或者将两者结合.

Permissions 可以在一个新的标识符下组合成一组, 这杯称为权限集, 这样就可以将与作用域相关的权限和与命令相关的权限结合起来.它还可以将特定于操作的权限跟组或者捆绑到更有用的集合中.

作为插件开发人员, 你可以为所有暴露的命令提供多个预定义的权限

作为应用开发人员, 你可以扩展已经存在的插件权限, 或为自己的命令定义权限, 他们可以被分组或扩展到一个集合中, 以便后续重复使用或简化主配置文件

## 权限(Permission) 标识符

权限标识符用于确保可重复使用并且具有唯一名称

:::tip

With **name** we refer to the plugin crate name without the `tauri-plugin-` prefix.
This is meant as namespacing to reduce likelihood of naming conflicts.
When referencing permissions of the application itself it is not necessary.

我们提到的 name 指的是不带 `tauri-plugin-` 前缀的插件 crate 名称, 这是为了减少命名冲突, 在引用应用程序本身的权限时, 则不需要这样做

:::

- `<name>:default` 表示该权限是插件或应用程序的默认权限
- `<name>:<command-name>` 表明该权限针对的是单个命令

插件前缀 `tauri-plugin-` 会在编译时自动添加到插件的 identifier 上, 不需要手动指定

标识符仅限于 ASCII 小写字母 `[a-z]`, 并且由于以下常量, 标识符目前的最大长度限制为 116 个字符:

```rust
const IDENTIFIER_SEPARATOR: u8 = b':';
const PLUGIN_PREFIX: &str = "tauri-plugin-";

// https://doc.rust-lang.org/cargo/reference/manifest.html#the-name-field
const MAX_LEN_PREFIX: usize = 64 - PLUGIN_PREFIX.len();
const MAX_LEN_BASE: usize = 64;
const MAX_LEN_IDENTIFIER: usize = MAX_LEN_PREFIX + 1 + MAX_LEN_BASE;
```

## 配置文件

简化的 Tauri 插件目录结构示例

```sh
tauri-plugin
├── README.md
├── src
│  └── lib.rs
├── build.rs
├── Cargo.toml
├── permissions
│  └── <identifier>.json/toml
│  └── default.json/toml
```

默认权限以特殊方式处理, 只要使用 Tauri CLI 向 Tauri 应用程序添加插件, 它就会自动添加到应用程序配置中

For **application** developers the structure is similar:

对于应用程序开发者来说, 结构类似:

```sh
tauri-app
├── index.html
├── package.json
├── src
├── src-tauri
│   ├── Cargo.toml
│   ├── permissions
│      └── <identifier>.toml
|   ├── capabilities
│      └── <identifier>.json/.toml
│   ├── src
│   ├── tauri.conf.json
```

:::note

作为应用开发人员, 能力文件可以用 `json`/`json5` or `toml` 格式编写, 然而权限只能定义在 `toml` 文件中

:::

## 示例

文件系统 插件权限示例

```toml title="plugins/fs/permissions/autogenerated/base-directories/home.toml"
[[permission]]
identifier = "scope-home"
description = "此范围允许访问所有文件, 并列出 `$HOME` 文件夹中顶层目录的内容"

[[scope.allow]]
path = "$HOME/*"
```

```toml title="plugins/fs/permissions/read-files.toml"
[[permission]]
identifier = "read-files"
description = "这使得所有与文件读取相关的命令, 在无需任何预先配置的可访问路径的情况下, 即可执行"
commands.allow = [
    "read_file",
    "read",
    "open",
    "read_text_file",
    "read_text_file_lines",
    "read_text_file_lines_next"
]
```

```toml title="plugins/fs/permissions/autogenerated/commands/mkdir.toml"
[[permission]]
identifier = "allow-mkdir"
description = "启用 mkdir 命令"
commands.allow = [
    "mkdir"
]
```

在你的应用程序中扩展上述插件权限的示例:

```toml title="my-app/src-tauri/permissions/home-read-extends.toml"
[[set]]
identifier = "allow-home-read-extended"
description = "这允许在 `$HOME` 文件夹中对文件进行非递归读取访问, 并创建目录"
permissions = [
    "fs:read-files",
    "fs:scope-home",
    "fs:allow-mkdir"
]
```
